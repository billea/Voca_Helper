<!DOCTYPE html>
<html>
<head>
    <title>Debug Vocabulary Cards</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .card { background: white; padding: 15px; margin: 10px 0; border-radius: 8px; border: 1px solid #ddd; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; }
        .empty { color: #dc3545; }
        .good { color: #28a745; }
        button { padding: 8px 16px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>üîß Vocabulary Cards Debug</h1>
    
    <div class="card">
        <h3>Quick Actions</h3>
        <button onclick="checkStorage()">Check Storage</button>
        <button onclick="showSampleCards()">Show Sample Cards</button>
        <button onclick="addTestCard()">Add Test Card</button>
        <button onclick="clearAllData()">Clear All Data</button>
    </div>
    
    <div id="results"></div>

    <script>
        const STORAGE_KEYS = {
            cards: 'vocab_cards_v1',
            prefs: 'vocab_prefs_v1',
            groups: 'vocab_groups_v1'
        };

        function checkStorage() {
            const results = document.getElementById('results');
            let html = '<div class="card"><h3>Storage Analysis</h3>';
            
            // Check cards
            const cardsData = localStorage.getItem(STORAGE_KEYS.cards);
            if (!cardsData) {
                html += '<p class="empty"><strong>‚ùå No cards found in localStorage!</strong></p>';
                html += '<p>localStorage key "vocab_cards_v1" is empty or missing.</p>';
            } else {
                try {
                    const cards = JSON.parse(cardsData);
                    html += `<p class="good"><strong>‚úÖ Found ${cards.length} cards in storage</strong></p>`;
                    
                    if (cards.length === 0) {
                        html += '<p class="empty">Cards array is empty - no vocabulary data loaded.</p>';
                    } else {
                        // Check first few cards
                        const validCards = cards.filter(c => c.word && c.word.trim());
                        const emptyCards = cards.length - validCards.length;
                        
                        html += `<p><strong>Valid cards:</strong> ${validCards.length}</p>`;
                        html += `<p><strong>Empty/invalid cards:</strong> ${emptyCards}</p>`;
                        
                        if (validCards.length > 0) {
                            html += '<p><strong>Sample valid cards:</strong></p>';
                            html += '<pre>' + JSON.stringify(validCards.slice(0, 3), null, 2) + '</pre>';
                        }
                        
                        if (emptyCards > 0) {
                            html += '<p class="empty"><strong>Sample empty cards:</strong></p>';
                            const emptyOnes = cards.filter(c => !c.word || !c.word.trim());
                            html += '<pre>' + JSON.stringify(emptyOnes.slice(0, 2), null, 2) + '</pre>';
                        }
                    }
                } catch (err) {
                    html += `<p class="empty"><strong>‚ùå Cards data corrupted!</strong> Error: ${err.message}</p>`;
                }
            }
            
            // Check other data
            const prefsData = localStorage.getItem(STORAGE_KEYS.prefs);
            html += `<p><strong>Preferences:</strong> ${prefsData ? '‚úÖ Present' : '‚ùå Missing'}</p>`;
            
            const groupsData = localStorage.getItem(STORAGE_KEYS.groups);
            html += `<p><strong>Groups:</strong> ${groupsData ? '‚úÖ Present' : '‚ùå Missing'}</p>`;
            
            html += '</div>';
            results.innerHTML = html;
        }

        function showSampleCards() {
            const results = document.getElementById('results');
            const cardsData = localStorage.getItem(STORAGE_KEYS.cards);
            
            if (!cardsData) {
                results.innerHTML = '<div class="card empty"><h3>No Data Found</h3><p>No vocabulary cards in localStorage.</p></div>';
                return;
            }
            
            try {
                const cards = JSON.parse(cardsData);
                let html = '<div class="card"><h3>All Cards Data</h3>';
                html += `<p>Total cards: ${cards.length}</p>`;
                html += '<pre style="max-height: 400px; overflow-y: auto;">' + JSON.stringify(cards, null, 2) + '</pre>';
                html += '</div>';
                results.innerHTML = html;
            } catch (err) {
                results.innerHTML = `<div class="card empty"><h3>Error</h3><p>Failed to parse cards: ${err.message}</p></div>`;
            }
        }

        function addTestCard() {
            try {
                const existing = localStorage.getItem(STORAGE_KEYS.cards);
                const cards = existing ? JSON.parse(existing) : [];
                
                const testCard = {
                    id: 'test_' + Date.now(),
                    word: 'test',
                    definition: 'A trial or examination',
                    example: 'This is a test card',
                    morphology: '',
                    synonyms: 'trial,exam',
                    antonyms: '',
                    pos: 'noun',
                    ef: 2.5,
                    interval: 0,
                    reps: 0,
                    due: Date.now(),
                    created: Date.now(),
                    seen: false
                };
                
                cards.push(testCard);
                localStorage.setItem(STORAGE_KEYS.cards, JSON.stringify(cards));
                
                document.getElementById('results').innerHTML = 
                    '<div class="card good"><h3>‚úÖ Test Card Added</h3><p>Refresh your vocabulary app to see it.</p></div>';
            } catch (err) {
                document.getElementById('results').innerHTML = 
                    `<div class="card empty"><h3>‚ùå Failed to Add Test Card</h3><p>${err.message}</p></div>`;
            }
        }

        function clearAllData() {
            if (confirm('‚ö†Ô∏è This will delete ALL vocabulary data. Continue?')) {
                Object.values(STORAGE_KEYS).forEach(key => {
                    localStorage.removeItem(key);
                });
                document.getElementById('results').innerHTML = 
                    '<div class="card good"><h3>‚úÖ All Data Cleared</h3><p>Refresh your vocabulary app - it should be empty now.</p></div>';
            }
        }

        // Auto-check on load
        window.addEventListener('load', checkStorage);
    </script>
</body>
</html>